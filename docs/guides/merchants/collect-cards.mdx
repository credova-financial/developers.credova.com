import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

import { Alert } from "@site/src/components/shared/Alert";
import GettingStartedSection from "@site/src/components/docs/_getting-started-section.mdx";
import ConfigureElementsSection from "@site/src/components/docs/_configure-elements-section.mdx";

# Collect Cards

In this guide, we will set up Credova Elements SDKs to capture cards in a frontend application and securely authorize and store the cardholder data while avoiding PCI requirements.

## Getting Started

<GettingStartedSection />

### Get your Publishable Key

Next you will need your `Publishable Key`. [Go to your Developers section](https://portal.credova.com/developers/api-keys) and click `Reveal` for your `Publishable Key` and copy the value.

<Alert>Save the Publishable Key as it will be used in the next steps of this guide.</Alert>

## Configuring Credova Elements

<ConfigureElementsSection />

## Adding Card Elements

Once installed and configured, add the Card Elements to your application.

<Tabs className="credova-tabs" queryString="sdk">
  <TabItem value="javascript" label="JavaScript">

```html showLineNumbers title=index.html
<input
  type="text"
  id="cardholderName"
  placeholder="Cardholder name"
  style={{ display: 'flex', width: '100%' }}
/>
<div id="cardNumber"></div>
<div style="display: flex;">
  <div id="cardExpirationDate" style="width: 100%;"></div>
  <div id="cardVerificationCode" style="width: 100%;"></div>
</div>
```

```javascript showLineNumbers title=index.js
import { Credova } from '@credova/elements-js';

let credova;
let cardNumberElement;
let cardExpirationDateElement;
let cardVerificationCodeElement;

async function init() {
  credova = await new Credova().init('<API_KEY>');

  //highlight-start
  // Creates Elements instances
  cardNumberElement = credova.createCardNumberElement();
  cardNumberElement.mount('#cardNumber');

  cardExpirationDateElement = credova.createCardExpirationDateElement();
  cardExpirationDateElement.mount('#cardExpirationDate');

  cardVerificationCodeElement = credova.createCardVerificationCodeElement();
  cardExpirationDateElement.mount('#cardVerificationCode');
  //highlight-end
}

init();
```
  </TabItem>

  <TabItem value="react" label="React">

```jsx showLineNumbers title=App.jsx
import React, { useRef, useState } from 'react';
import {
  CredovaProvider,
  // highlight-start
  CardNumberElement,
  CardExpirationDateElement,
  CardVerifcationCodeElement,
  //highlight-end
  useCredova,
} from '@credova/elements-react';

export default function App() {
  const { credova } = useCredova();
  // highlight-start
  // Refs to get access to the Elements instance
  const cardholderNameRef = useRef(null);
  const cardNumberRef = useRef(null);
  const cardExpirationRef = useRef(null);
  const cardVerificationRef = useRef(null);
  // highlight-end

  return (
    <CredovaProvider apiKey={apiKey}>
      <input
        type="text"
        id="cardholderName"
        placeholder="Cardholder name"
        ref={cardholderNameRef}
        style={{ display: 'flex', width: '100%' }}
      />

      // highlight-start
      <CardNumberElement
        id="cardNumber"
        ref={cardNumberRef}
      />
      // highlight-end
      <div style={{ display: 'flex' }}>
        <div style={{ width: '100%' }}>
          // highlight-start
          <CardExpirationDateElement
            id="cardExpirationDate"
            ref={cardExpirationRef}
          />
          // highlight-end
        </div>
        <div style={{ width: '100%' }}>
          // highlight-start
          <CardVerificationCodeElement
            id="cardVerificationCode"
            ref={cardVerificationRef}
            cardBrand={cardBrand}
          />
          // highlight-end
        </div>
      </div>
    </CredovaProvider>
  );
}
```
  </TabItem>
</Tabs>


## Storing Cards

Now that you are cardholder data in your web application, it is time to store the card in your account.

To do this, we will call the `create card` method from the SDK, passing the Card Elements as data points in the payload.

Add a submit function along with a button to trigger it:

<Tabs className="credova-tabs" queryString="sdk">
  <TabItem value="javascript" label="JavaScript">

```html showLineNumbers title=index.html
<!-- Form from above -->
// highlight-next-line
<button id="submit">Submit</button>
```

```javascript showLineNumbers title=index.js
async function init () {
  ...
  //highlight-next-line
  document.getElementById("submit").addEventListener("click", submit);
}

// highlight-start
async function submit (e: FormEvent<HTMLFormElement>,) {
  try {
    const formData = new FormData(e.currentTarget)

    const card = await credova.cards.create({
      cardholder_name: formData.cardholderName,
      card: {
        number: cardNumberElement,
        expiration_month: cardExpirationDateElement.month(),
        expiration_year: cardExpirationDateElement.year(),
        cvc: cardVerificationCodeElement,
      }
    });
    // store card.id in your database
  } catch (error) {
    console.error(error);
  }
}
// highlight-end

init();
```
  </TabItem>
  <TabItem value="react" label="React">

```jsx showLineNumbers title=App.jsx
export default function App() {
  // highlight-start
  const submit = async () => {
    try {
      const card = await credova?.tokens.create({
        cardholder_name: cardholderNameRef.current,
        card: {
          number: cardNumberRef.current,
          expiration_month: cardExpirationRef.current.month(),
          expiration_year: cardExpirationRef.current.year(),
          cvc: cardVerificationRef.current,
        }
      });
      // store card.id in your database
    } catch (error) {
      console.error(error);
    }
  }
  // highlight-end

  return (
    <CredovaProvider bt={bt}>
      ...
      // highlight-next-line
      <button onClick={submit}>Submit</button>
    </CredovaProvider>
  );
}
```
  </TabItem>
</Tabs>

The created `card` object contains the non-sensitive information about the card:

```json showLineNumbers title=card.json
{
  "id": "card_AjkCFKAYiTsjghXWMzoXFPMxj",
  "account_id": "acc_B518niGwGYKzig6vtrRVZGGGV",
  "environment": "test",
  "cardholder_name": "John Smith",
  "last4": "4242",
  "exp_month": "12",
  "exp_year": "2025",
  "fingerprint": "CC2XvyoohnqecEq4r3FtXv6MdCx4TbaW1UUTdCCN5MNL",
  "created_at": "2024-06-30T01:02:29.212Z",
  "modified_at": "2024-06-30T01:02:29.212Z"
}
```

You can safely store the card's `id` value in your database to link it with the appropriate payment or customer association.

You can optionally pass in a `customer_id` to associate with an existing [Created Customer](/api/create-customer) and `billing_details` to remove the requirement to pass them when [Creating a Payment](/api/create-payment).

## Conclusion

Following this guide, you have successfully collected a customer's credit card. To use this card, proceed with the [Process Payments](/guides/process-payments) guide.
