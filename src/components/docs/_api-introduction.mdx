import { Intro } from "@site/src/components/shared/Intro";
import { Alert, Alerts } from "@site/src/components/shared/Alert";

<Intro
  title="API Reference"
  caption="API endpoints to manage the full lifecycle of your Credova integration."
/>

The Credova API is organized around REST. Our API is built with a predictable resource-oriented structure, uses JSON-encoded requests and responses, follows standard HTTP verbs/responses, and uses industry standard authentication.

## Authentication

Credova uses API keys to allow access to the API.

Credova requires the API key to be included in all API requests to the server in a header that looks like the following:

`X-API-KEY: <API_KEY>`

<Alert>You must replace <code>&lt;API_KEY></code> with your `Secret` or a `Restricted` API key.</Alert>

#### Request

```shell showLineNumbers
curl "https://api.credova.com" \
  -H "X-API-KEY: <API_KEY>"
```

## Request Correlation

Credova utilizes Correlation IDs to assist with request tracing, logging, and debugging.

All API endpoints accept a client-provided Correlation ID if sent with the `X-CORRELATION-ID` HTTP header within `POST`, `PUT`, and `DELETE` methods.

If a `X-CORRELATION-ID` Correlation ID is not provided by the client, a new Correlation ID will be generated by the Credova API.

#### Example

```shell showLineNumbers
curl "https://api.credova.com" \
  -H "X-API-KEY: <API_KEY>" \
  -H "X-CORRELATION-ID: aa5d3379-6385-4ef4-9fdb-ca1341572153"
```

## Idempotency

Credova supports idempotency to guarantee multiple retries of the same request do not
unintentionally perform the same operation more than once.

Our API endpoints accept a client-provided `Idempotency Key` if sent with the `IDEMPOTENCY-KEY` `HTTP` header within `POST` and `PUT` methods.

If an `Idempotency Key` is not provided by the client, retrying the same request might result in unwanted behavior.

The `Idempotency Key` must be a unique value generated by the client which is used by the Credova
API to identify subsequent requests belong to an original request. The `Idempotency Key` generation is up to the
client, but we strongly recommend using a unique identifier such as `UUID` to avoid collisions.

When the first request comes in, its response status code and body is saved. Whenever a subsequent
request comes in with the same `Idempotency Key`, the previous stored result will be returned if it
succeeded. If the first request failed, the result is not stored and a subsequent request with the
same `Idempotency Key` is processed as a new request. If any subsequent request comes in while
the first is still processing, a `409` status code is returned.

If an `Idempotency Key` is provided for a `GET` or `DELETE` request, it is ignored and idempotency logic
is not invoked, since these `HTTP` verbs are idempotent by definition.

All idempotency keys and their respective results are deleted after 24 hours. Therefore, if an
`Idempotency Key` is reused after 24 hours, it will be handled as a new request.

#### Example

```shell showLineNumbers
curl "https://api.credova.com" \
-H "X-API-KEY: <API_KEY>" \
-H "IDEMPOTENCY-KEY: aa5d3379-6385-4ef4-9fdb-ca1341572153"
```

## Pagination

Most `List` endpoints support pagination to allow bulk fetching multiple items. Each `List` endpoint shares a common response structure.

#### Request

```shell showLineNumbers
  curl "https://api.credova.com/payments?page=2&size=10" \
  -H "X-API-KEY: <API_KEY>"
```

#### Query Parameters

| Parameter | Required | Type      | Default | Description                                                        |
| --------- | -------- | --------- | ------- | ------------------------------------------------------------------ |
| `page`    | false    | _integer_ | 1       | Page number of the results to return.                              |
| `size`    | false    | _integer_ | 20      | Number of results per page to return. Maximum size of 100 results. |

#### Response

```json showLineNumbers
{
  "pagination": {
    "total_items": 924,
    "page_number": 2,
    "page_size": 10,
    "total_pages": 93
  },
  "data": [
    {...},
    {...},
    {...}
  ]
}
```

### Pagination Object

| Attribute    | Type                                                                      | Description                                                                             |
| ------------ | ------------------------------------------------------------------------- | --------------------------------------------------------------------------------------- |
| `pagination` | _[offset pagination metadata](#pagination-metadata-object)                | Pagination metadata for the response                                                    |
| `data`       | _array_                                                                   | Query results of the request. See list endpoint resource for response schema definition |

#### Pagination Metadata Object

| Attribute     | Type      | Description                                                 |
| ------------- | --------- | ----------------------------------------------------------- |
| `total_items` | _integer_ | Total number of items in the Tenant                         |
| `page_number` | _integer_ | Current page number. Should match `page` query parameter.   |
| `page_size`   | _integer_ | The size of each page. Should match `size` query parameter. |
| `total_pages` | _integer_ | The total number of pages.                                  |

## Errors

Credova uses standard HTTP status codes to indicate whether an API request succeeded or failed.
A response with a `2xx` status code indicates success, a `4xx` status code indicates a failure due to information provided with the request,
and a `5xx` status code indicates an unexpected error occurred within Credova.

In general, errors are returned with a response body that conforms to the
[RFC 7807 - Problem Details for HTTP APIs](https://datatracker.ietf.org/doc/html/rfc7807) specification, as illustrated below.

```shell showLineNumbers
{
  "type": "string",
  "title": "string",
  "status": 400,
  "detail": "string",
  "instance": "string",
  "errors": {
    "additionalProp1": ["string"],
    "additionalProp2": ["string"],
    "additionalProp3": ["string"]
  }
}
```

### Response

| Attribute           | Type      | Description                                                                 |
|---------------------|-----------|-----------------------------------------------------------------------------|
| `title`             | _string_  | A short, human-readable summary of the problem                              |
| `detail`            | _string_  | A human-readable explanation specific to this occurrence of the problem     |
| `errors.{property}` | _array_   | An array of human readable error messages returned per request `{property}` |
| `status`            | _integer_ | HTTP status code of the response                                            |

### Error Codes

| Error Code | Meaning                                                          |
|------------|------------------------------------------------------------------|
| `400`      | Invalid request body                                             |
| `401`      | A missing or invalid `X-API-KEY` was provided                    |
| `403`      | The provided `X-API-KEY` does not have the required permissions  |
| `404`      | Resource was not found                                           |
| `409`      | Conflict with the current state of the request entity            |
| `422`      | Request does not satisfy requirements for processing             |
| `500`      | Something went wrong on Credova's side                           |
